# ๐ก๏ธ ุฑุงูููุง ูุฏุฑุช ุฎุทุงูุง ู Timeout

ุงู ุณูุฏ ุชูุถุญ ูโุฏูุฏ ฺฉู ุฑุจุงุช ฺฺฏููู ุฎุทุงูุง ู timeoutโูุง ุฑุง ูุฏุฑุช ูโฺฉูุฏ.

## ๐ฏ ุงููุงุน ุฎุทุงูุง

### 1. Timeout Errors โฑ๏ธ

**ุนูุช:**
- ูุงู ุจุฒุฑฺฏ
- ุงุชุตุงู ุงูุชุฑูุช ุถุนู
- ุณุฑูุฑ Telegram ูพุงุณุฎ ููโุฏูุฏ

**ุฑุงู ุญู ุฑุจุงุช:**
- โ 3 ุจุงุฑ ุชูุงุด ูุฌุฏุฏ
- โ Exponential backoff (5s, 10s, 15s)
- โ Timeout ูุงุจู ุชูุธู (ูพุดโูุฑุถ: 120 ุซุงูู)
- โ ฺฏุฒุงุฑุด ุจู ุงุฏูู ุฏุฑ ุตูุฑุช ุดฺฉุณุช ููุง

**ูุงฺฏ ููููู:**
```
โฑ๏ธ Timeout on attempt 1/3 for Coffee
โณ Waiting 5s before retry...
๐ค Attempt 2/3: Sending Coffee
โ Successfully sent: Coffee
```

### 2. Rate Limiting (Flood Control) ๐ซ

**ุนูุช:**
- ุงุฑุณุงู ุฎู ุณุฑุน ุจู Telegram
- ูุญุฏูุฏุช ุชุนุฏุงุฏ ูพุงู ุฏุฑ ูุงุญุฏ ุฒูุงู

**ุฑุงู ุญู ุฑุจุงุช:**
- โ ุชุดุฎุต ุฎุทุง "flood" ุง "too many requests"
- โ ุตุจุฑ 60 ุซุงูู ุจุฑุง ุงููู ุจุงุฑ
- โ ุตุจุฑ 120 ุซุงูู ุจุฑุง ุจุงุฑ ุฏูู
- โ ุตุจุฑ 180 ุซุงูู ุจุฑุง ุจุงุฑ ุณูู
- โ ูุงุตูู 3 ุซุงูู ุจู ุงุฑุณุงู ูููู
- โ ูุงุตูู 5 ุซุงูู ุจุนุฏ ุงุฒ ุดฺฉุณุช

**ูุงฺฏ ููููู:**
```
๐ซ Rate limited. Waiting 60s...
๐ค Retry after cooldown...
```

### 3. Channel Errors ๐บ

**ุนูุช:**
- ุฑุจุงุช ุฏุฑ ฺูู Admin ูุณุช
- ฺูู ูพุฏุง ูุดุฏ
- ID ฺูู ุงุดุชุจุงู ุงุณุช

**ุฑุงู ุญู ุฑุจุงุช:**
- โ ุชุดุฎุต ุฎุทุง "chat not found"
- โ ุนุฏู ุชูุงุด ูุฌุฏุฏ (ุฎุทุง ุฏุงุฆู)
- โ ุงุทูุงุน ููุฑ ุจู ุงุฏูู
- โ ุชููู ุงุฑุณุงู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุฏุฑ ุฑูุช ููุงุจุน

**ูุงฺฏ ููููู:**
```
โ Channel not found or bot not admin: @wrongchannel
โ ุฎุทุง: ฺูู ุจุฑุง ุงู ูพูโูุณุช ุชูุธู ูุดุฏู ุงุณุช!
```

### 4. File Size Errors ๐ฆ

**ุนูุช:**
- ูุงู ุจุด ุงุฒ 50 ูฺฏุงุจุงุช
- ูุญุฏูุฏุช Telegram Bot API

**ุฑุงู ุญู ุฑุจุงุช:**
- โ ููุงุด ุณุงุฒ ูุงู ูุจู ุงุฒ ุงุฑุณุงู
- โ ุชุดุฎุต ุฎุทุง "file is too big"
- โ ุนุฏู ุชูุงุด ูุฌุฏุฏ
- โ ฺฏุฒุงุฑุด ูุงูโูุง ุจุฒุฑฺฏ ุจู ุงุฏูู

**ูุงฺฏ ููููู:**
```
๐ฆ File size: 52.3 MB
โ File too large: Long Song (52.3 MB)
```

### 5. Network Errors ๐

**ุนูุช:**
- ูุทุน ุงูุชุฑูุช
- ูุดฺฉู DNS
- Firewall

**ุฑุงู ุญู ุฑุจุงุช:**
- โ 3 ุจุงุฑ ุชูุงุด ูุฌุฏุฏ
- โ ุตุจุฑ ุจู ุชูุงุดโูุง
- โ ุงุฏุงูู ุจุง ุขููฺฏ ุจุนุฏ ุฏุฑ ุตูุฑุช ุดฺฉุณุช
- โ ุงุทูุงุน ุจู ุงุฏูู ุจุฑุง ุฎุทุงูุง ุญุงุช

## ๐ง ุชูุธูุงุช

### ุชุบุฑ Timeout

ุฏุฑ `bot.py` ุฎุท ูุฑุจูุท ุจู `send_audio_to_channel`:

```python
async def send_audio_to_channel(
    self, file_path: str, track_name: str, 
    artist_name: str, channel_id: str, 
    max_retries: int = 3,      # ุชุนุฏุงุฏ ุชูุงุด
    timeout: int = 120         # ุซุงูู (ุชุบุฑ ุฏูุฏ)
) -> bool:
```

**ููุงุฏุฑ ูพุดููุงุฏ:**
- ุงุชุตุงู ุณุฑุน: `timeout = 60`
- ุงุชุตุงู ูุนููู: `timeout = 120` (ูพุดโูุฑุถ)
- ุงุชุตุงู ฺฉูุฏ: `timeout = 180`
- ูุงูโูุง ุจุฒุฑฺฏ: `timeout = 300`

### ุชุบุฑ ุชุนุฏุงุฏ Retry

```python
max_retries: int = 3  # ุชุบุฑ ุจู 5 ุจุฑุง ุซุจุงุช ุจุดุชุฑ
```

### ุชุบุฑ Rate Limiting

ุฏุฑ ุจุฎุด `process_new_tracks`:

```python
# ุจุนุฏ ุงุฒ ุงุฑุณุงู ูููู
await asyncio.sleep(3)  # ุชุบุฑ ุจู 5 ุจุฑุง ุงููุช ุจุดุชุฑ

# ุจุนุฏ ุงุฒ ุดฺฉุณุช
await asyncio.sleep(5)  # ุชุบุฑ ุจู 10 ุจุฑุง cooldown ุจุดุชุฑ
```

## ๐ ฺฏุฒุงุฑุดโูุง

### ฺฏุฒุงุฑุด ููููุช โ

```
๐ Summary: 8 succeeded, 2 failed out of 10 tracks
โ Successfully sent 8 tracks to @channel
```

### ฺฏุฒุงุฑุด ุดฺฉุณุช ุจู ุงุฏูู โ

```
โ๏ธ ฺฏุฒุงุฑุด ุงุฑุณุงู ุขููฺฏโูุง:

โ ูููู: 8
โ ูุงูููู: 2

ุขููฺฏโูุง ูุงูููู:
โข Coffee - beabadoobee
โข Long Track Name - Artist
```

### ูุงฺฏ ุฏูู ๐

```
๐ค Attempt 1/3: Sending Coffee
๐ฆ File size: 3.45 MB
๐ค Sending: Coffee - beabadoobee
๐ File path: /app/downloads/Coffee.mp3
โ Successfully sent: Coffee - beabadoobee to @channel
โ Marked as sent: Coffee
๐๏ธ Cleaned up: /app/downloads/Coffee.mp3
```

## ๐จ ุฎุทุงูุง ุญุงุช

ุฑุจุงุช ุจุฑุง ุฎุทุงูุง ุฒุฑ ููุฑุงู ุจู ุงุฏูู ุงุทูุงุน ูโุฏูุฏ:

1. **NetworkError**: ูุดฺฉู ุดุจฺฉู
2. **TimedOut**: ุชูุงู ุชูุงุดโูุง timeout ุดุฏูุฏ
3. **RetryAfter**: Telegram ุฏุฑุฎูุงุณุช ฺฉุงูุด ุณุฑุนุช ุฏุงุฏู
4. **Conflict**: bot instance ุฏฺฏุฑ ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช
5. **Unauthorized**: ุชูฺฉู ูุงูุนุชุจุฑ ุง ูููุถ ุดุฏู

**ูพุงู ููููู:**
```
๐จ ุฎุทุง ุญุงุช:

ููุน: NetworkError
ูพุงู: httpx.RemoteProtocolError: Server disconnected
```

## ๐ ุนุจโุงุจ

### ูุดฺฉู: ููู ุขููฺฏโูุง timeout ูโุดููุฏ

**ุฑุงู ุญูโูุง:**
1. Timeout ุฑุง ุงูุฒุงุด ุฏูุฏ (180 ุง 300)
2. ุงุชุตุงู ุงูุชุฑูุช ุฑุง ุจุฑุฑุณ ฺฉูุฏ
3. ุงุฒ VPN ุงุณุชูุงุฏู ฺฉูุฏ ุงฺฏุฑ Telegram ููุชุฑ ุงุณุช
4. ูุงูโูุง ุจุฒุฑฺฏ ุฑุง ฺฉูฺฺฉโุชุฑ ฺฉูุฏ (ุชูุธู bitrate)

### ูุดฺฉู: Rate limiting ูุฏุงูู

**ุฑุงู ุญูโูุง:**
1. ูุงุตูู ุจู ุงุฑุณุงูโูุง ุฑุง ุงูุฒุงุด ุฏูุฏ (5-10 ุซุงูู)
2. ุชุนุฏุงุฏ ูพูโูุณุชโูุง ุฑุง ฺฉุงูุด ุฏูุฏ
3. ุจุงุฒู ฺฺฉ ุฑุง ุงูุฒุงุด ุฏูุฏ (12 ุณุงุนุช ุจู ุฌุง 6)

### ูุดฺฉู: Channel not found

**ุฑุงู ุญูโูุง:**
1. ูุทูุฆู ุดูุฏ ุฑุจุงุช ุฏุฑ ฺูู Admin ุงุณุช
2. ID ฺูู ุฑุง ุฏูุจุงุฑู ุจุฑุฑุณ ฺฉูุฏ
3. ุงุฒ `/linkplaylist` ุงุณุชูุงุฏู ฺฉูุฏ
4. ุฏุณุชุฑุณโูุง ุฑุจุงุช ุฑุง ุจุฑุฑุณ ฺฉูุฏ

### ูุดฺฉู: ูุงูโูุง ุฎู ุจุฒุฑฺฏ ูุณุชูุฏ

**ุฑุงู ุญูโูุง:**
1. ุฏุฑ `config.json` bitrate ุฑุง ฺฉุงูุด ุฏูุฏ:
```json
"settings": {
  "bitrate": "96"  // ุจู ุฌุง 128
}
```

2. ุง ุฏุฑ ฺฉุฏ ุชุบุฑ ุฏูุฏ:
```python
bitrate=self.config_manager.config['settings']['bitrate']
```

## ๐ ุจูุชุฑู ุดููโูุง

### 1. ุชูุธูุงุช ูุชุนุงุฏู โ๏ธ

```python
max_retries = 3          # ฺฉุงู ุจุฑุง ุงฺฉุซุฑ ููุงุฑุฏ
timeout = 120            # 2 ุฏููู
sleep_after_success = 3  # ุฌููฺฏุฑ ุงุฒ rate limit
sleep_after_fail = 5     # cooldown ุจุดุชุฑ
```

### 2. ูุงูุชูุฑูฺฏ ๐

ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ:
```bash
docker-compose logs -f | grep -E "โ|โ๏ธ|๐จ"
```

ููุท ุฎุทุงูุง:
```bash
docker-compose logs | grep ERROR
```

ุขูุงุฑ ููููุช:
```bash
docker-compose logs | grep "๐ Summary"
```

### 3. Backup ู Recovery ๐พ

ุฏุฑ ุตูุฑุช ุฎุทุงูุง ูฺฉุฑุฑ:

```bash
# Backup database
cp tracks_database.json tracks_database.json.backup

# Restart
docker-compose restart

# ุงฺฏุฑ ูุงุฒ ุจู rebuild ุงุณุช
docker-compose down
docker-compose up -d --build
```

### 4. Notification Settings ๐

ุชูุธู ุงุทูุงุนโุฑุณุงูโูุง:

**ุฎุทุงูุง ููู:**
- โ Channel errors
- โ ARL problems
- โ Network failures

**ุฎุทุงูุง ุนุงุฏ:**
- โ Single timeout (retry ูโุดูุฏ)
- โ Rate limiting (ุฎูุฏฺฉุงุฑ ูุฏุฑุช ูโุดูุฏ)

## ๐ฏ ุฎูุงุตู

| ุฎุทุง | Retry | Backoff | ุงุทูุงุน ุจู ุงุฏูู |
|-----|-------|---------|----------------|
| Timeout | โ 3x | 5s, 10s, 15s | ุฏุฑ ุตูุฑุช ุดฺฉุณุช ููุง |
| Rate Limit | โ 3x | 60s, 120s, 180s | ุฎุฑ |
| Channel Error | โ | - | โ ููุฑ |
| File Too Big | โ | - | โ ููุฑ |
| Network Error | โ 3x | 5s, 10s, 15s | ุจุฑุง ุฎุทุงูุง ุญุงุช |

---

**ุขุฎุฑู ุจุฑูุฒุฑุณุงู**: ุงฺฉุชุจุฑ 2025  
**ูุณุฎู**: 2.1  
**ูุงุจูุช**: Advanced Error Handling & Timeout Management
